{% extends "base.html" %}

{% block content %}
<div class="dashboard">
    <div class="dashboard-header">
        <h1><i class="fas fa-tachometer-alt"></i> لوحة تحكم المدير</h1>
    </div>

    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-users"></i>
            </div>
            <div class="stat-info">
                <h3>{{ total_employees }}</h3>
                <p>إجمالي الموظفين</p>
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-calendar-check"></i>
            </div>
            <div class="stat-info">
                <h3>{{ pending_vacations }}</h3>
                <p>طلبات إجازة معلقة</p>
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-user-times"></i>
            </div>
            <div class="stat-info">
                <h3>{{ today_absences }}</h3>
                <p>غياب اليوم</p>
            </div>
        </div>
    </div>

    <div class="dashboard-sections">
        <div class="section-card">
            <h3><i class="fas fa-users-cog"></i> إدارة الموظفين</h3>
            <div class="section-links">
                <a href="{{ url_for('employees.employees_list') }}" class="section-link">
                    <i class="fas fa-list"></i>
                    عرض جميع الموظفين
                </a>
                <a href="#import" class="section-link">
                    <i class="fas fa-file-import"></i>
                    استيراد بيانات
                </a>
            </div>
        </div>

        <div class="section-card">
            <h3><i class="fas fa-calendar-alt"></i> إدارة الإجازات</h3>
            <div class="section-links">
                <a href="{{ url_for('vacations_list') }}" class="section-link">
                    <i class="fas fa-list"></i>
                    جميع طلبات الإجازة
                </a>
                <a href="#approvals" class="section-link">
                    <i class="fas fa-check-circle"></i>
                    الموافقات المعلقة ({{ pending_vacations }})
                </a>
            </div>
        </div>
    </div>

    {% if vacation_requests %}
    <div class="pending-requests">
        <h3><i class="fas fa-clock"></i> طلبات الإجازة المعلقة</h3>
        <div class="table-responsive">
            <table class="data-table">
                <thead>
                    <tr>
                        <th>الموظف</th>
                        <th>القسم</th>
                        <th>نوع الإجازة</th>
                        <th>من</th>
                        <th>إلى</th>
                        <th>المدة</th>
                        <th>الحالة</th>
                        <th>الإجراءات</th>
                    </tr>
                </thead>
                <tbody>
                    {% for request in vacation_requests %}
                    <tr>
                        <td>{{ request.employee_name }}</td>
                        <td>{{ request.department }}</td>
                        <td>{{ request.type }}</td>
                        <td>{{ request.start_date }}</td>
                        <td>{{ request.end_date }}</td>
                        <td>{{ request.duration }} أيام</td>
                        <td>
                            <span class="status status-pending">
                                {{ request.status }}
                            </span>
                        </td>
                        <td>
                            <div class="action-buttons">
                                <button class="btn btn-sm btn-success" onclick="approveVacation({{ request.id }})">
                                    <i class="fas fa-check"></i>
                                </button>
                                <button class="btn btn-sm btn-danger" onclick="rejectVacation({{ request.id }})">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    {% endif %}
</div>

<script>
function approveVacation(vacationId) {
    fetch(`/approve/vacation/${vacationId}`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert(data.message);
            location.reload();
        } else {
            alert('حدث خطأ: ' + data.error);
        }
    });
}

function rejectVacation(vacationId) {
    if (confirm('هل أنت متأكد من رفض هذه الإجازة؟')) {
        // سيتم تنفيذ وظيفة الرفض
        alert('سيتم رفض الإجازة');
    }
}
</script>
{% endblock %}